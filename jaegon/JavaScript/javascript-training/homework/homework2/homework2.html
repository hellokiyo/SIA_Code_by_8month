<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8"> <!-- 문자 인코딩 설정 -->
    <title>과제 02 기능이 더 많은 입장료 계산기 만들기</title> <!-- 브라우저 탭에 표시될 제목 -->

    <style>
        h2 {
            margin: 0 auto;
        }
        #output2 {
            width: 60px;

            position: relative;
            left: 90px;
        }

        .group1 {
            padding-bottom: 30px;
            border: 2px solid blue;
            width: 370px;

        }

        .group2 {
            border: 2px solid blue;
            justify-content: space-around;
            padding-top: 20px;
            position: relative;
            left: 10px;
            top: 10px;
            width: 340px;
        }

        .btn {
            position: absolute;
            left: 280px;
            top: 100px;
            padding: 18px 25px;
        }

        .draw {
            width: 25px;
            height: 25px;
        }
        .total {
            width: 40px;
            height: 20px;
        }
    </style>
</head>

<body>
<h2>화면구성</h2>  <!-- 제목 표시 -->

<div class="group1"> <!-- 전체 폼 영역 -->

    <div>
        <div id="now"></div>
    </div>

    <span>성인 수</span> <input id="input1" type="text" value=""><span>명</span>
    <button class="btn" onclick="fee()">계산</button> <!-- 클릭 시 add() 함수 실행 -->


    <!--라디오 버튼 안눌르면 alart로 단체할인 여부 묻는거 해보고 싶다.-->
    <p></p>
    <span>어린이 수</span> <input id="input2" type="text" value=""><span>명</span>


    <div> <!-- 결과 출력 영역 -->
        <p></p>
        <p></p>
        <span>입장료</span>
        <input id="output1" type="text"> <!--입장료 계산 출력-->
    </div>


    <div> <!-- 라디오 버튼: 성별 선택 -->
        <span>단체할인</span>
        <input id="yes" name="yesno" type="radio" value="yes"><span>예</span>
        <input id="no" name="yesno" type="radio" value="no"><span>아니요</span>
        <img id="output2" src="" style="display:none">  <!--계속 바뀌는 사진-->
    </div>

    <div id="defaultFee">
        <p>1인당 요금</p>

        <div class="group2"> <!-- 1인당 요금 입력 영역 -->
            <span>성인 1인당</span> <input id="adultFee" type="text" value="20000"><span>원</span>
            <p></p>
            <span>어린이 1인당</span> <input id="kidFee" type="text" value="9900"><span>원</span>

            <p>단체 할인 : 5명 이상 20%</p><!-- 안내문 -->
        </div>
    </div>

    <div id="nightFee" style="display:none">
        <p>야간 할인</p>

        <div class="group2"> <!-- 1인당 요금 입력 영역 -->
            <span>성인 1인당</span> <input id="nightAdultFee" type="text" value="12000"><span>원</span>
            <p></p>
            <span>어린이 1인당</span> <input id="nightKidFee" type="text" value="4500"><span>원</span>

            <p>오후 6시부터 야간 할인이 적용됩니다.</p><!-- 안내문 -->
        </div>
    </div>

    <div>
        <p>이벤트</p>
        <div class="group2">
            <span>입장인원 : <span id="totalNumber">0</span> 명</span>
            <p>입장인원 : </p><input id="output3" class= "total" type="text" >

            <button id="luckyBtn" onclick="draw()">추첨하기</button>
            <p></p>
            <span>당첨자</span>
            <input class="draw" id="draw1" type="text">
            <input class="draw" id="draw2" type="text">
            <input class="draw" id="draw3" type="text">
            <input class="draw" id="draw4" type="text">
            <input class="draw" id="draw5" type="text">
            <input class="draw" id="draw6" type="text">

            <p>입장하시는 분들은 번호표를 받으세요.</p>
            <p>여섯 분을 추첨하여 스타벅스 쿠폰을 드립니다.</p>

        </div>

    </div>

</div>

<script src="../../AK_0724/moment.js"></script>
<script>
    let nowHour = moment().hour();

    function draw() {
        let total = Number(document.getElementById('output3').value)
        document.getElementById('totalNumber').innerText = total;
        for (let i = 1; i <= 6; i++) {
            document.querySelector(`#draw${i}`).value = Math.floor((Math.random() * total) + 1);
        }
        /*  중복값제거
            const luckyBox = [];
            luckyBox.push(Math.floor((Math.random()*80)+1));
            document.querySelector(`#draw${i}`).value = luckyBox[i];
        */
    }

    // HTML 문서가 다 로드되면 실행되는 이벤트
    window.addEventListener('DOMContentLoaded', () => {
        console.log(`DOMContentLoaded 이벤트 호출됨.`);

        const a =document.querySelector('#adultFee')
        const b = document.querySelector('#kidFee')
        a.value= Number(a.value).toLocaleString();
        b.value= Number(b.value).toLocaleString();

        // 현재 시간 표시하기
        let now = document.querySelector('#now');

        let curTime = moment().format('YYYY-MM-DD HH:mm:ss');
        now.innerHTML = `<p>${curTime}</p>`;

        setInterval(() => {
            let curTime = moment().format('YYYY-MM-DD HH:mm:ss'); // moment.js로 현재 시간 구하기
            now.innerHTML = `<p>${curTime}</p>`; //innerHTML사용시 태그를 넣을 수 있음
        }, 1000); // 1초마다 갱신

        if (nowHour >= 18) {
            document.querySelector('#defaultFee').style.display = "none";
            document.querySelector('#nightFee').style.display = "block";

            const c =document.querySelector('#nightAdultFee')
            const d =document.querySelector('#nightKidFee')

            c.value = Number(c.value).toLocaleString();
            d.value = Number(d.value).toLocaleString()

        }
    });


    if (nowHour > 17) {
        nightAdultFee = Number(document.querySelector('#nightAdultFee').value);
        nightKidFee = Number(document.querySelector('#nightKidFee').value);
        alert("야간 할인 적용 시간입니다.");
        document.querySelector('#nightFee').style = "display:block";

    }

    function fee() {
        const input1 = Number(document.querySelector('#input1').value); // 성인 수 입력값
        const input2 = Number(document.querySelector('#input2').value); // 어린이 수 입력값

        const input1Str = document.querySelector('#input1').value.trim();
        const input2Str = document.querySelector('#input2').value.trim();

        let adultFee = Number(document.querySelector('#adultFee').value.replace(/,/g,'')); // 성인 요금
        let kidFee = Number(document.querySelector('#kidFee').value.replace(/,/g,''));     // 어린이 요금

        if (isNaN(input1) || isNaN(input2) || input1Str === "" || input2Str === "") { // 숫자가 아닌 값이 들어오면
            alert(`다시 입력해주세요`); // 팝업창 표시
            output1.innerHTML = ``; // 결과 영역 비우기
            document.querySelector('#output2').src = "images/fail.png";
            document.querySelector('#nightFee').style = "display:block";
            return; // 함수 종료
        }

        let baseFee = input1 * adultFee + input2 * kidFee; // 기본 입장료 계산

        let isGroupDiscount = document.querySelector('input[name="yesno"]:checked').value === 'yes';
        // :는 앞에 것중 선택된 걸 의미 그리고 .value 앞에 선택된 input중에서 체크된것의 value를 뽑아온다.
        // === 값과 타입이 모두 일치해야함
        //!!!!!!따라서 라디오 버튼이 예 로 선택되어 있는지 확인하는 코드


        if (nowHour > 17) {
            let nightAdultFee = Number(document.querySelector('#nightAdultFee').value.replace(/,/g,''));
            let nightKidFee = Number(document.querySelector('#nightKidFee').value.replace(/,/g,''));

            let finalFee = (input1 * nightAdultFee) + (input2 * nightKidFee);

            document.querySelector('#output1').value = finalFee.toLocaleString();
            document.querySelector('#output2').src = "images/success.png";
            document.querySelector('#output2').style.display = "block";
            return;
        }

        let finalFee; // 최종 입장료

        if (input1 + input2 < 5) {
            if (isGroupDiscount) {
                document.getElementById("no").checked = true;
                alert("단체 할인 적용 대상이 아닙니다.")
            }
            finalFee = baseFee; // 할인 없음

        } else if (input1 + input2 >= 5) {
            if (!isGroupDiscount) {
                document.getElementById("yes").checked = true;
                alert("단체 할인 적용 대상입니다.")
            }
            finalFee = (baseFee * 0.8); // 20% 할인 적용
        }

        document.querySelector('#output1').value = finalFee.toLocaleString();
        document.querySelector('#output2').src = "images/success.png";
        document.querySelector('#output2').style = "display:block";
    }

</script>
</body>
</html>